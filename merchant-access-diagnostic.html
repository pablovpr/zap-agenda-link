<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico de Acesso - √Årea do Comerciante</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .diagnostic-section {
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .issue {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .solution {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .info {
            background-color: #e7f3ff;
            border-color: #007bff;
            color: #004085;
        }

        .code-block {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            overflow-x: auto;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .test-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .test-button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .test-button:hover {
            background-color: #0056b3;
        }

        .test-button.success {
            background-color: #28a745;
        }

        .test-button.success:hover {
            background-color: #1e7e34;
        }

        .test-button.warning {
            background-color: #ffc107;
            color: #212529;
        }

        .test-button.warning:hover {
            background-color: #e0a800;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .checklist li:before {
            content: "üîç ";
            margin-right: 8px;
        }

        .steps {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .steps li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            counter-increment: step-counter;
            position: relative;
            padding-left: 40px;
        }

        .steps li:before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 10px;
            background: #007bff;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç Diagn√≥stico de Acesso - √Årea do Comerciante</h1>

        <div class="diagnostic-section issue">
            <h2>‚ùå Problema Reportado</h2>
            <p><strong>Situa√ß√£o:</strong> N√£o conseguindo acessar a √°rea do comerciante</p>
            <p><strong>Comportamento esperado:</strong> Acesso ao dashboard administrativo</p>
            <p><strong>Comportamento atual:</strong> Acesso bloqueado ou redirecionamento incorreto</p>
        </div>

        <div class="diagnostic-section info">
            <h2>üîç Poss√≠veis Causas</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>1. Problema de Autentica√ß√£o</h4>
                    <ul class="checklist">
                        <li>Usu√°rio n√£o est√° logado</li>
                        <li>Sess√£o expirou</li>
                        <li>Token inv√°lido</li>
                        <li>Erro no Supabase Auth</li>
                    </ul>
                </div>

                <div class="test-card">
                    <h4>2. Perfil Incompleto</h4>
                    <ul class="checklist">
                        <li>company_name n√£o definido</li>
                        <li>Perfil n√£o foi criado</li>
                        <li>Redirecionamento para /company-setup</li>
                        <li>Erro na verifica√ß√£o do perfil</li>
                    </ul>
                </div>

                <div class="test-card">
                    <h4>3. Problemas de Rota</h4>
                    <ul class="checklist">
                        <li>Redirecionamento incorreto</li>
                        <li>Rota n√£o encontrada</li>
                        <li>Conflito com rota p√∫blica</li>
                        <li>Erro no React Router</li>
                    </ul>
                </div>

                <div class="test-card">
                    <h4>4. Erro de Configura√ß√£o</h4>
                    <ul class="checklist">
                        <li>Vari√°veis de ambiente</li>
                        <li>Configura√ß√£o do Supabase</li>
                        <li>Pol√≠ticas RLS</li>
                        <li>Permiss√µes de banco</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="diagnostic-section solution">
            <h2>üõ†Ô∏è Passos de Diagn√≥stico</h2>
            <ol class="steps">
                <li>
                    <strong>Verificar Console do Navegador</strong><br>
                    Abra as ferramentas de desenvolvedor (F12) e verifique se h√° erros no console
                </li>
                <li>
                    <strong>Testar Autentica√ß√£o</strong><br>
                    Acesse /auth e tente fazer login com suas credenciais
                </li>
                <li>
                    <strong>Verificar Redirecionamentos</strong><br>
                    Observe para onde voc√™ est√° sendo redirecionado ap√≥s o login
                </li>
                <li>
                    <strong>Testar Perfil</strong><br>
                    Verifique se o perfil da empresa est√° completo
                </li>
                <li>
                    <strong>Limpar Cache</strong><br>
                    Limpe o cache do navegador e tente novamente
                </li>
            </ol>
        </div>

        <div class="diagnostic-section info">
            <h2>üîß Fluxo de Autentica√ß√£o</h2>
            <p>Entenda como funciona o acesso √† √°rea do comerciante:</p>

            <div class="code-block">
                FLUXO NORMAL:
                1. Usu√°rio acessa "/" (raiz)
                2. Index.tsx verifica se h√° usu√°rio logado
                3. Se n√£o logado ‚Üí redireciona para "/auth"
                4. Se logado ‚Üí verifica se perfil est√° completo
                5. Se perfil incompleto ‚Üí redireciona para "/company-setup"
                6. Se tudo OK ‚Üí mostra dashboard do comerciante

                POSS√çVEIS PONTOS DE FALHA:
                - useAuth n√£o detecta usu√°rio logado
                - fetchProfile falha ou retorna dados incompletos
                - Redirecionamento em loop
                - Erro na verifica√ß√£o de sess√£o
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <h3>üß™ Testes R√°pidos</h3>
            <button class="test-button success" onclick="window.open('/', '_blank')">
                üè† Testar Acesso √† Raiz
            </button>
            <button class="test-button" onclick="window.open('/auth', '_blank')">
                üîê Testar P√°gina de Login
            </button>
            <button class="test-button warning" onclick="window.open('/company-setup', '_blank')">
                üè¢ Testar Setup da Empresa
            </button>
        </div>

        <div class="diagnostic-section solution">
            <h2>‚úÖ Solu√ß√µes R√°pidas</h2>

            <div class="test-grid">
                <div class="test-card">
                    <h4>Solu√ß√£o 1: Limpar Dados</h4>
                    <ol>
                        <li>Abra as ferramentas de desenvolvedor (F12)</li>
                        <li>V√° para Application/Storage</li>
                        <li>Limpe localStorage e sessionStorage</li>
                        <li>Recarregue a p√°gina</li>
                    </ol>
                </div>

                <div class="test-card">
                    <h4>Solu√ß√£o 2: Novo Login</h4>
                    <ol>
                        <li>Acesse /auth</li>
                        <li>Fa√ßa logout se necess√°rio</li>
                        <li>Fa√ßa login novamente</li>
                        <li>Verifique se √© redirecionado corretamente</li>
                    </ol>
                </div>

                <div class="test-card">
                    <h4>Solu√ß√£o 3: Verificar Perfil</h4>
                    <ol>
                        <li>Acesse /company-setup</li>
                        <li>Preencha/atualize dados da empresa</li>
                        <li>Salve as informa√ß√µes</li>
                        <li>Tente acessar / novamente</li>
                    </ol>
                </div>

                <div class="test-card">
                    <h4>Solu√ß√£o 4: Modo Inc√≥gnito</h4>
                    <ol>
                        <li>Abra uma janela inc√≥gnita</li>
                        <li>Acesse a aplica√ß√£o</li>
                        <li>Fa√ßa login normalmente</li>
                        <li>Verifique se funciona</li>
                    </ol>
                </div>
            </div>
        </div>

        <div class="diagnostic-section info">
            <h2>üìã Checklist de Verifica√ß√£o</h2>
            <div class="code-block">
                VERIFIQUE NO CONSOLE:
                ‚ñ° Erros de JavaScript
                ‚ñ° Erros de rede (404, 500, etc.)
                ‚ñ° Mensagens de autentica√ß√£o
                ‚ñ° Logs do useAuth
                ‚ñ° Logs do fetchProfile

                VERIFIQUE NO NETWORK:
                ‚ñ° Requisi√ß√µes para Supabase
                ‚ñ° Status das requisi√ß√µes
                ‚ñ° Respostas de erro
                ‚ñ° Tempo de resposta

                VERIFIQUE NO APPLICATION:
                ‚ñ° localStorage tem dados do Supabase
                ‚ñ° sessionStorage est√° limpo
                ‚ñ° Cookies est√£o corretos
                ‚ñ° IndexedDB n√£o tem conflitos
            </div>
        </div>

        <div class="diagnostic-section solution">
            <h2>üÜò Se Nada Funcionar</h2>
            <p>Se as solu√ß√µes acima n√£o resolverem, tente estas op√ß√µes avan√ßadas:</p>

            <div class="code-block">
                OP√á√ïES AVAN√áADAS:
                1. Criar nova conta de teste
                2. Verificar configura√ß√£o do Supabase
                3. Testar em navegador diferente
                4. Verificar pol√≠ticas RLS no banco
                5. Revisar vari√°veis de ambiente
                6. Testar conex√£o com banco de dados

                INFORMA√á√ïES PARA DEBUG:
                - URL atual quando o problema ocorre
                - Mensagens de erro no console
                - Comportamento espec√≠fico observado
                - Passos para reproduzir o problema
                - Navegador e vers√£o utilizados
            </div>
        </div>

        <div class="diagnostic-section info">
            <h2>üìû Pr√≥ximos Passos</h2>
            <p>Para resolver o problema, precisamos de mais informa√ß√µes:</p>
            <ol class="steps">
                <li>Execute os testes r√°pidos acima</li>
                <li>Anote qualquer erro que aparecer no console</li>
                <li>Informe qual solu√ß√£o funcionou (se alguma)</li>
                <li>Se nenhuma funcionar, compartilhe os erros encontrados</li>
            </ol>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üîç Diagn√≥stico de Acesso Carregado');
            console.log('üìã Execute os testes e verifique o console para erros');
            console.log('üõ†Ô∏è Siga os passos de diagn√≥stico para identificar o problema');

            // Verificar se h√° dados de autentica√ß√£o
            const supabaseData = localStorage.getItem('sb-' + window.location.hostname.replace(/\./g, '-') + '-auth-token');
            if (supabaseData) {
                console.log('‚úÖ Dados de autentica√ß√£o encontrados no localStorage');
                try {
                    const authData = JSON.parse(supabaseData);
                    console.log('üë§ Usu√°rio:', authData.user?.email || 'N√£o encontrado');
                    console.log('‚è∞ Sess√£o expira em:', new Date(authData.expires_at * 1000));
                } catch (e) {
                    console.log('‚ùå Erro ao parsear dados de autentica√ß√£o');
                }
            } else {
                console.log('‚ùå Nenhum dado de autentica√ß√£o encontrado');
            }
        });
    </script>
</body>

</html>